Portfolio-optimization problem with CVaR
========================================

This folder includes the test case described in Section 4 of the paper.

Setup of the optimization model
-------------------------------

The optimization model is in file `portfolio_opt.mos` and is implemented in the [FICO Xpress Mosel](https://community.fico.com/s/fico-xpress-mosel-mathematical) modelling language.
Xpress Mosel is now available for free under the [ Xpress Community License](https://content.fico.com/xpress-optimization-community-license) - requires registration.

In addition, solving the model requires an LP/MIP solver supporting the AMPL .nl interface.
By default, the model is set up to use an AMPL-aware version of the [HiGHS solver](https://highs.dev/), available for example from [AMPL web page](https://ampl.com/products/solvers/open-source-solvers/).

To use a different solver, adjust the `SOLVER` (solver name) and `SOLVER_PATH` (solver file name if different from the name) parameters in the scripts described below.
The Mosel documentation mentions the following supported solvers and their parameters:

- Xpress Optimizer (requires license)
  - `SOLVER=xpress`, `SOLVER_PATH=amplxpress.exe`
- Knitro (requires license)
  - `SOLVER=knitro`, `SOLVER_PATH=knitroampl.exe`
- Cplex (requires license)
  - `SOLVER=cplex`, `SOLVER_PATH=cplexamp.exe`
- IPOPT
  - `SOLVER=ipopt`
- Cbc
  - `SOLVER=cbc`, `SOLVER_PATH=cbc.bat`, where `cbc.bat` includes '`cbc %3 -AMPL`' - this is included in the folder
- SCIP'
  - `SOLVER=scip`, `SOLVER_PATH=scip.bat`, where `scip.bat` includes '`scipampl %3 -AMPL`'
  
All the open-source solvers can be obtaned from the same [AMPL web page](https://ampl.com/products/solvers/open-source-solvers/).


Scripts for running the tests
-----------------------------

In addition to the model, the folder includes scripts for running the test, both as Windows batch files (`*.bat`) and bash scripts (`*.sh`). For the rest of this README, just replace `.bat` with `.sh` for Linux.

The scripts should be run in the following sequence:

1. `gen_scen.bat`
  - this generates scenarios for prices from folder `prices`, using the different methods described in the paper
  - method selection is done be setting the `METHODS` variable in the script
2. `solve_full_data.bat`
  - this solves the optimization model with the complete price sets, to serve as a benchmarks in further comparisons
3. `solve_scen-problems.bat`
  - this solves the problems using all the scenario sets from step 1.
4. `eval_scen_solutions.bat`
  - this runs the out-of-sample evaluation of the scenario-based solutions on the corresponding full data sets
  - it saves the results into file `eval_scen_solutions.csv`

### Notes

In `gen_scen.bat`, if describe the format of the input CSV files using the `FORMAT` variable with value `--col-sep tab --index-col date`.
This is passed as command-line arguments to `scengen_select.py`.
Instead, the same could be given in a JSON config file as 

```json
{
	"$schema": "../../scen-gen_select.schema.json",
	"input": {
    "index-col": "date",
		"column-sep": "tab"
	}
}
```
and then passed to `scengen_select.py` as `-c <filename>.json`.
Note that the "`$schema`" key is optional, but allows for syntax checking by the generator.


Post-processing scripts
-----------------------

Finally, the folder includes two python scripts for post-processing the results and creating some of the figures shown in the paper.
Both files take several command-line arguments, run them with `--help` for a syntax overview.

- `process_scens.py`
  - creates timing plots for the scenario generation, based on the a log file generated by `gen_scen.bat`
  - if run from the same folder as `gen_scen.bat` (with default settings), it does not need any arguments.
- `process_results.py`
  - creates evaluation plots for the optiomization results, based on file `eval_scen_solutions.csv` generated by `eval_scen_solutions.bat`.
  - requires python package `seaborn`!
  - if run from the same folder as `eval_scen_solutions.bat` (with default settings), it does not need any arguments.
